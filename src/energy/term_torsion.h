// term_torsion.h --- torsion angle energy term
// Copyright (C) 2009-2011 Kristoffer Enøe Johansson
//
// This file is part of Phaistos
//
// Phaistos is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
//
// Phaistos is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with Phaistos.  If not, see <http://www.gnu.org/licenses/>.
//

#ifndef TERM_GROMACS_TORSION_H
#define TERM_GROMACS_TORSION_H

#include <boost/type_traits/is_base_of.hpp>
#include "energy/energy_term.h"

namespace phaistos {

     const unsigned int dihedrals_9[843][4] =  {{   2,     1,     5,     6},   // 9
                                                {   2,     1,     5,     7},   // 9
                                                {   2,     1,     5,    15},   // 9
                                                {   3,     1,     5,     6},   // 9
                                                {   3,     1,     5,     7},   // 9
                                                {   3,     1,     5,    15},   // 9
                                                {   4,     1,     5,     6},   // 9
                                                {   4,     1,     5,     7},   // 9
                                                {   4,     1,     5,    15},   // 9
                                                {   1,     5,     7,     8},   // 9
                                                {   1,     5,     7,     9},   // 9
                                                {   1,     5,     7,    10},   // 9
                                                {   6,     5,     7,     8},   // 9
                                                {   6,     5,     7,     9},   // 9
                                                {   6,     5,     7,    10},   // 9
                                                {  15,     5,     7,     8},   // 9
                                                {  15,     5,     7,     9},   // 9
                                                {  15,     5,     7,    10},   // 9
                                                {   1,     5,    15,    16},   // 9
                                                {   1,     5,    15,    17},   // 9
                                                {   6,     5,    15,    16},   // 9
                                                {   6,     5,    15,    17},   // 9
                                                {   7,     5,    15,    16},   // 9
                                                {   7,     5,    15,    17},   // 9
                                                {   5,     7,    10,    11},   // 9
                                                {   5,     7,    10,    12},   // 9
                                                {   8,     7,    10,    11},   // 9
                                                {   8,     7,    10,    12},   // 9
                                                {   9,     7,    10,    11},   // 9
                                                {   9,     7,    10,    12},   // 9
                                                {   7,    10,    12,    13},   // 9
                                                {   7,    10,    12,    14},   // 9
                                                {  11,    10,    12,    13},   // 9
                                                {  11,    10,    12,    14},   // 9
                                                {   5,    15,    17,    18},   // 9
                                                {   5,    15,    17,    19},   // 9
                                                {  16,    15,    17,    18},   // 9
                                                {  16,    15,    17,    19},   // 9
                                                {  15,    17,    19,    20},   // 9
                                                {  15,    17,    19,    21},   // 9
                                                {  15,    17,    19,    34},   // 9
                                                {  18,    17,    19,    20},   // 9
                                                {  18,    17,    19,    21},   // 9
                                                {  18,    17,    19,    34},   // 9
                                                {  17,    19,    21,    22},   // 9
                                                {  17,    19,    21,    23},   // 9
                                                {  17,    19,    21,    24},   // 9
                                                {  20,    19,    21,    22},   // 9
                                                {  20,    19,    21,    23},   // 9
                                                {  20,    19,    21,    24},   // 9
                                                {  34,    19,    21,    22},   // 9
                                                {  34,    19,    21,    23},   // 9
                                                {  34,    19,    21,    24},   // 9
                                                {  17,    19,    34,    35},   // 9
                                                {  17,    19,    34,    36},   // 9
                                                {  20,    19,    34,    35},   // 9
                                                {  20,    19,    34,    36},   // 9
                                                {  21,    19,    34,    35},   // 9
                                                {  21,    19,    34,    36},   // 9
                                                {  19,    21,    24,    25},   // 9
                                                {  19,    21,    24,    26},   // 9
                                                {  19,    21,    24,    30},   // 9
                                                {  22,    21,    24,    25},   // 9
                                                {  22,    21,    24,    26},   // 9
                                                {  22,    21,    24,    30},   // 9
                                                {  23,    21,    24,    25},   // 9
                                                {  23,    21,    24,    26},   // 9
                                                {  23,    21,    24,    30},   // 9
                                                {  21,    24,    26,    27},   // 9
                                                {  21,    24,    26,    28},   // 9
                                                {  21,    24,    26,    29},   // 9
                                                {  25,    24,    26,    27},   // 9
                                                {  25,    24,    26,    28},   // 9
                                                {  25,    24,    26,    29},   // 9
                                                {  30,    24,    26,    27},   // 9
                                                {  30,    24,    26,    28},   // 9
                                                {  30,    24,    26,    29},   // 9
                                                {  21,    24,    30,    31},   // 9
                                                {  21,    24,    30,    32},   // 9
                                                {  21,    24,    30,    33},   // 9
                                                {  25,    24,    30,    31},   // 9
                                                {  25,    24,    30,    32},   // 9
                                                {  25,    24,    30,    33},   // 9
                                                {  26,    24,    30,    31},   // 9
                                                {  26,    24,    30,    32},   // 9
                                                {  26,    24,    30,    33},   // 9
                                                {  19,    34,    36,    37},   // 9
                                                {  19,    34,    36,    38},   // 9
                                                {  35,    34,    36,    37},   // 9
                                                {  35,    34,    36,    38},   // 9
                                                {  34,    36,    38,    39},   // 9
                                                {  34,    36,    38,    40},   // 9
                                                {  34,    36,    38,    55},   // 9
                                                {  37,    36,    38,    39},   // 9
                                                {  37,    36,    38,    40},   // 9
                                                {  37,    36,    38,    55},   // 9
                                                {  36,    38,    40,    41},   // 9
                                                {  36,    38,    40,    42},   // 9
                                                {  36,    38,    40,    43},   // 9
                                                {  39,    38,    40,    41},   // 9
                                                {  39,    38,    40,    42},   // 9
                                                {  39,    38,    40,    43},   // 9
                                                {  55,    38,    40,    41},   // 9
                                                {  55,    38,    40,    42},   // 9
                                                {  55,    38,    40,    43},   // 9
                                                {  36,    38,    55,    56},   // 9
                                                {  36,    38,    55,    57},   // 9
                                                {  39,    38,    55,    56},   // 9
                                                {  39,    38,    55,    57},   // 9
                                                {  40,    38,    55,    56},   // 9
                                                {  40,    38,    55,    57},   // 9
                                                {  38,    40,    43,    44},   // 9
                                                {  38,    40,    43,    51},   // 9
                                                {  41,    40,    43,    44},   // 9
                                                {  41,    40,    43,    51},   // 9
                                                {  42,    40,    43,    44},   // 9
                                                {  42,    40,    43,    51},   // 9
                                                {  40,    43,    44,    45},   // 9
                                                {  40,    43,    44,    46},   // 9
                                                {  51,    43,    44,    45},   // 9
                                                {  51,    43,    44,    46},   // 9
                                                {  40,    43,    51,    52},   // 9
                                                {  40,    43,    51,    53},   // 9
                                                {  44,    43,    51,    52},   // 9
                                                {  44,    43,    51,    53},   // 9
                                                {  43,    44,    46,    47},   // 9
                                                {  43,    44,    46,    48},   // 9
                                                {  45,    44,    46,    47},   // 9
                                                {  45,    44,    46,    48},   // 9
                                                {  44,    46,    48,    49},   // 9
                                                {  44,    46,    48,    53},   // 9
                                                {  47,    46,    48,    49},   // 9
                                                {  47,    46,    48,    53},   // 9
                                                {  46,    48,    49,    50},   // 9
                                                {  53,    48,    49,    50},   // 9
                                                {  46,    48,    53,    51},   // 9
                                                {  46,    48,    53,    54},   // 9
                                                {  49,    48,    53,    51},   // 9
                                                {  49,    48,    53,    54},   // 9
                                                {  43,    51,    53,    48},   // 9
                                                {  43,    51,    53,    54},   // 9
                                                {  52,    51,    53,    48},   // 9
                                                {  52,    51,    53,    54},   // 9
                                                {  38,    55,    57,    58},   // 9
                                                {  38,    55,    57,    59},   // 9
                                                {  56,    55,    57,    58},   // 9
                                                {  56,    55,    57,    59},   // 9
                                                {  55,    57,    59,    60},   // 9
                                                {  55,    57,    59,    61},   // 9
                                                {  55,    57,    59,    74},   // 9
                                                {  58,    57,    59,    60},   // 9
                                                {  58,    57,    59,    61},   // 9
                                                {  58,    57,    59,    74},   // 9
                                                {  57,    59,    61,    62},   // 9
                                                {  57,    59,    61,    63},   // 9
                                                {  57,    59,    61,    67},   // 9
                                                {  60,    59,    61,    62},   // 9
                                                {  60,    59,    61,    63},   // 9
                                                {  60,    59,    61,    67},   // 9
                                                {  74,    59,    61,    62},   // 9
                                                {  74,    59,    61,    63},   // 9
                                                {  74,    59,    61,    67},   // 9
                                                {  57,    59,    74,    75},   // 9
                                                {  57,    59,    74,    76},   // 9
                                                {  60,    59,    74,    75},   // 9
                                                {  60,    59,    74,    76},   // 9
                                                {  61,    59,    74,    75},   // 9
                                                {  61,    59,    74,    76},   // 9
                                                {  59,    61,    63,    64},   // 9
                                                {  59,    61,    63,    65},   // 9
                                                {  59,    61,    63,    66},   // 9
                                                {  62,    61,    63,    64},   // 9
                                                {  62,    61,    63,    65},   // 9
                                                {  62,    61,    63,    66},   // 9
                                                {  67,    61,    63,    64},   // 9
                                                {  67,    61,    63,    65},   // 9
                                                {  67,    61,    63,    66},   // 9
                                                {  59,    61,    67,    68},   // 9
                                                {  59,    61,    67,    69},   // 9
                                                {  59,    61,    67,    70},   // 9
                                                {  62,    61,    67,    68},   // 9
                                                {  62,    61,    67,    69},   // 9
                                                {  62,    61,    67,    70},   // 9
                                                {  63,    61,    67,    68},   // 9
                                                {  63,    61,    67,    69},   // 9
                                                {  63,    61,    67,    70},   // 9
                                                {  61,    67,    70,    71},   // 9
                                                {  61,    67,    70,    72},   // 9
                                                {  61,    67,    70,    73},   // 9
                                                {  68,    67,    70,    71},   // 9
                                                {  68,    67,    70,    72},   // 9
                                                {  68,    67,    70,    73},   // 9
                                                {  69,    67,    70,    71},   // 9
                                                {  69,    67,    70,    72},   // 9
                                                {  69,    67,    70,    73},   // 9
                                                {  59,    74,    76,    77},   // 9
                                                {  59,    74,    76,    78},   // 9
                                                {  75,    74,    76,    77},   // 9
                                                {  75,    74,    76,    78},   // 9
                                                {  74,    76,    78,    79},   // 9
                                                {  74,    76,    78,    80},   // 9
                                                {  74,    76,    78,    91},   // 9
                                                {  77,    76,    78,    79},   // 9
                                                {  77,    76,    78,    80},   // 9
                                                {  77,    76,    78,    91},   // 9
                                                {  76,    78,    80,    81},   // 9
                                                {  76,    78,    80,    82},   // 9
                                                {  76,    78,    80,    83},   // 9
                                                {  79,    78,    80,    81},   // 9
                                                {  79,    78,    80,    82},   // 9
                                                {  79,    78,    80,    83},   // 9
                                                {  91,    78,    80,    81},   // 9
                                                {  91,    78,    80,    82},   // 9
                                                {  91,    78,    80,    83},   // 9
                                                {  76,    78,    91,    92},   // 9
                                                {  76,    78,    91,    93},   // 9
                                                {  79,    78,    91,    92},   // 9
                                                {  79,    78,    91,    93},   // 9
                                                {  80,    78,    91,    92},   // 9
                                                {  80,    78,    91,    93},   // 9
                                                {  78,    80,    83,    84},   // 9
                                                {  78,    80,    83,    85},   // 9
                                                {  78,    80,    83,    86},   // 9
                                                {  81,    80,    83,    84},   // 9
                                                {  81,    80,    83,    85},   // 9
                                                {  81,    80,    83,    86},   // 9
                                                {  82,    80,    83,    84},   // 9
                                                {  82,    80,    83,    85},   // 9
                                                {  82,    80,    83,    86},   // 9
                                                {  80,    83,    86,    87},   // 9
                                                {  80,    83,    86,    88},   // 9
                                                {  84,    83,    86,    87},   // 9
                                                {  84,    83,    86,    88},   // 9
                                                {  85,    83,    86,    87},   // 9
                                                {  85,    83,    86,    88},   // 9
                                                {  83,    86,    88,    89},   // 9
                                                {  83,    86,    88,    90},   // 9
                                                {  87,    86,    88,    89},   // 9
                                                {  87,    86,    88,    90},   // 9
                                                {  78,    91,    93,    94},   // 9
                                                {  78,    91,    93,    95},   // 9
                                                {  92,    91,    93,    94},   // 9
                                                {  92,    91,    93,    95},   // 9
                                                {  91,    93,    95,    96},   // 9
                                                {  91,    93,    95,    97},   // 9
                                                {  91,    93,    95,   115},   // 9
                                                {  94,    93,    95,    96},   // 9
                                                {  94,    93,    95,    97},   // 9
                                                {  94,    93,    95,   115},   // 9
                                                {  93,    95,    97,    98},   // 9
                                                {  93,    95,    97,    99},   // 9
                                                {  93,    95,    97,   100},   // 9
                                                {  96,    95,    97,    98},   // 9
                                                {  96,    95,    97,    99},   // 9
                                                {  96,    95,    97,   100},   // 9
                                                { 115,    95,    97,    98},   // 9
                                                { 115,    95,    97,    99},   // 9
                                                { 115,    95,    97,   100},   // 9
                                                {  93,    95,   115,   116},   // 9
                                                {  93,    95,   115,   117},   // 9
                                                {  96,    95,   115,   116},   // 9
                                                {  96,    95,   115,   117},   // 9
                                                {  97,    95,   115,   116},   // 9
                                                {  97,    95,   115,   117},   // 9
                                                {  95,    97,   100,   101},   // 9
                                                {  95,    97,   100,   106},   // 9
                                                {  98,    97,   100,   101},   // 9
                                                {  98,    97,   100,   106},   // 9
                                                {  99,    97,   100,   101},   // 9
                                                {  99,    97,   100,   106},   // 9
                                                {  97,   100,   101,   102},   // 9
                                                {  97,   100,   101,   103},   // 9
                                                { 106,   100,   101,   102},   // 9
                                                { 106,   100,   101,   103},   // 9
                                                {  97,   100,   106,   105},   // 9
                                                {  97,   100,   106,   107},   // 9
                                                { 101,   100,   106,   105},   // 9
                                                { 101,   100,   106,   107},   // 9
                                                { 100,   101,   103,   104},   // 9
                                                { 100,   101,   103,   105},   // 9
                                                { 102,   101,   103,   104},   // 9
                                                { 102,   101,   103,   105},   // 9
                                                { 101,   103,   105,   106},   // 9
                                                { 101,   103,   105,   111},   // 9
                                                { 104,   103,   105,   106},   // 9
                                                { 104,   103,   105,   111},   // 9
                                                { 103,   105,   106,   100},   // 9
                                                { 103,   105,   106,   107},   // 9
                                                { 111,   105,   106,   100},   // 9
                                                { 111,   105,   106,   107},   // 9
                                                { 103,   105,   111,   112},   // 9
                                                { 103,   105,   111,   113},   // 9
                                                { 106,   105,   111,   112},   // 9
                                                { 106,   105,   111,   113},   // 9
                                                { 100,   106,   107,   108},   // 9
                                                { 100,   106,   107,   109},   // 9
                                                { 105,   106,   107,   108},   // 9
                                                { 105,   106,   107,   109},   // 9
                                                { 106,   107,   109,   110},   // 9
                                                { 106,   107,   109,   113},   // 9
                                                { 108,   107,   109,   110},   // 9
                                                { 108,   107,   109,   113},   // 9
                                                { 107,   109,   113,   111},   // 9
                                                { 107,   109,   113,   114},   // 9
                                                { 110,   109,   113,   111},   // 9
                                                { 110,   109,   113,   114},   // 9
                                                { 105,   111,   113,   109},   // 9
                                                { 105,   111,   113,   114},   // 9
                                                { 112,   111,   113,   109},   // 9
                                                { 112,   111,   113,   114},   // 9
                                                {  95,   115,   117,   118},   // 9
                                                {  95,   115,   117,   119},   // 9
                                                { 116,   115,   117,   118},   // 9
                                                { 116,   115,   117,   119},   // 9
                                                { 115,   117,   119,   120},   // 9
                                                { 115,   117,   119,   121},   // 9
                                                { 115,   117,   119,   134},   // 9
                                                { 118,   117,   119,   120},   // 9
                                                { 118,   117,   119,   121},   // 9
                                                { 118,   117,   119,   134},   // 9
                                                { 117,   119,   121,   122},   // 9
                                                { 117,   119,   121,   123},   // 9
                                                { 117,   119,   121,   124},   // 9
                                                { 120,   119,   121,   122},   // 9
                                                { 120,   119,   121,   123},   // 9
                                                { 120,   119,   121,   124},   // 9
                                                { 134,   119,   121,   122},   // 9
                                                { 134,   119,   121,   123},   // 9
                                                { 134,   119,   121,   124},   // 9
                                                { 117,   119,   134,   135},   // 9
                                                { 117,   119,   134,   136},   // 9
                                                { 120,   119,   134,   135},   // 9
                                                { 120,   119,   134,   136},   // 9
                                                { 121,   119,   134,   135},   // 9
                                                { 121,   119,   134,   136},   // 9
                                                { 119,   121,   124,   125},   // 9
                                                { 119,   121,   124,   126},   // 9
                                                { 119,   121,   124,   130},   // 9
                                                { 122,   121,   124,   125},   // 9
                                                { 122,   121,   124,   126},   // 9
                                                { 122,   121,   124,   130},   // 9
                                                { 123,   121,   124,   125},   // 9
                                                { 123,   121,   124,   126},   // 9
                                                { 123,   121,   124,   130},   // 9
                                                { 121,   124,   126,   127},   // 9
                                                { 121,   124,   126,   128},   // 9
                                                { 121,   124,   126,   129},   // 9
                                                { 125,   124,   126,   127},   // 9
                                                { 125,   124,   126,   128},   // 9
                                                { 125,   124,   126,   129},   // 9
                                                { 130,   124,   126,   127},   // 9
                                                { 130,   124,   126,   128},   // 9
                                                { 130,   124,   126,   129},   // 9
                                                { 121,   124,   130,   131},   // 9
                                                { 121,   124,   130,   132},   // 9
                                                { 121,   124,   130,   133},   // 9
                                                { 125,   124,   130,   131},   // 9
                                                { 125,   124,   130,   132},   // 9
                                                { 125,   124,   130,   133},   // 9
                                                { 126,   124,   130,   131},   // 9
                                                { 126,   124,   130,   132},   // 9
                                                { 126,   124,   130,   133},   // 9
                                                { 119,   134,   136,   137},   // 9
                                                { 119,   134,   136,   138},   // 9
                                                { 135,   134,   136,   137},   // 9
                                                { 135,   134,   136,   138},   // 9
                                                { 134,   136,   138,   139},   // 9
                                                { 134,   136,   138,   140},   // 9
                                                { 134,   136,   138,   156},   // 9
                                                { 137,   136,   138,   139},   // 9
                                                { 137,   136,   138,   140},   // 9
                                                { 137,   136,   138,   156},   // 9
                                                { 136,   138,   140,   141},   // 9
                                                { 136,   138,   140,   142},   // 9
                                                { 136,   138,   140,   143},   // 9
                                                { 139,   138,   140,   141},   // 9
                                                { 139,   138,   140,   142},   // 9
                                                { 139,   138,   140,   143},   // 9
                                                { 156,   138,   140,   141},   // 9
                                                { 156,   138,   140,   142},   // 9
                                                { 156,   138,   140,   143},   // 9
                                                { 136,   138,   156,   157},   // 9
                                                { 136,   138,   156,   158},   // 9
                                                { 139,   138,   156,   157},   // 9
                                                { 139,   138,   156,   158},   // 9
                                                { 140,   138,   156,   157},   // 9
                                                { 140,   138,   156,   158},   // 9
                                                { 138,   140,   143,   144},   // 9
                                                { 138,   140,   143,   145},   // 9
                                                { 138,   140,   143,   146},   // 9
                                                { 141,   140,   143,   144},   // 9
                                                { 141,   140,   143,   145},   // 9
                                                { 141,   140,   143,   146},   // 9
                                                { 142,   140,   143,   144},   // 9
                                                { 142,   140,   143,   145},   // 9
                                                { 142,   140,   143,   146},   // 9
                                                { 140,   143,   146,   147},   // 9
                                                { 140,   143,   146,   148},   // 9
                                                { 140,   143,   146,   149},   // 9
                                                { 144,   143,   146,   147},   // 9
                                                { 144,   143,   146,   148},   // 9
                                                { 144,   143,   146,   149},   // 9
                                                { 145,   143,   146,   147},   // 9
                                                { 145,   143,   146,   148},   // 9
                                                { 145,   143,   146,   149},   // 9
                                                { 143,   146,   149,   150},   // 9
                                                { 143,   146,   149,   151},   // 9
                                                { 143,   146,   149,   152},   // 9
                                                { 147,   146,   149,   150},   // 9
                                                { 147,   146,   149,   151},   // 9
                                                { 147,   146,   149,   152},   // 9
                                                { 148,   146,   149,   150},   // 9
                                                { 148,   146,   149,   151},   // 9
                                                { 148,   146,   149,   152},   // 9
                                                { 146,   149,   152,   153},   // 9
                                                { 146,   149,   152,   154},   // 9
                                                { 146,   149,   152,   155},   // 9
                                                { 150,   149,   152,   153},   // 9
                                                { 150,   149,   152,   154},   // 9
                                                { 150,   149,   152,   155},   // 9
                                                { 151,   149,   152,   153},   // 9
                                                { 151,   149,   152,   154},   // 9
                                                { 151,   149,   152,   155},   // 9
                                                { 138,   156,   158,   159},   // 9
                                                { 138,   156,   158,   160},   // 9
                                                { 157,   156,   158,   159},   // 9
                                                { 157,   156,   158,   160},   // 9
                                                { 156,   158,   160,   161},   // 9
                                                { 156,   158,   160,   162},   // 9
                                                { 156,   158,   160,   168},   // 9
                                                { 159,   158,   160,   161},   // 9
                                                { 159,   158,   160,   162},   // 9
                                                { 159,   158,   160,   168},   // 9
                                                { 158,   160,   162,   163},   // 9
                                                { 158,   160,   162,   164},   // 9
                                                { 158,   160,   162,   165},   // 9
                                                { 161,   160,   162,   163},   // 9
                                                { 161,   160,   162,   164},   // 9
                                                { 161,   160,   162,   165},   // 9
                                                { 168,   160,   162,   163},   // 9
                                                { 168,   160,   162,   164},   // 9
                                                { 168,   160,   162,   165},   // 9
                                                { 158,   160,   168,   169},   // 9
                                                { 158,   160,   168,   170},   // 9
                                                { 161,   160,   168,   169},   // 9
                                                { 161,   160,   168,   170},   // 9
                                                { 162,   160,   168,   169},   // 9
                                                { 162,   160,   168,   170},   // 9
                                                { 160,   162,   165,   166},   // 9
                                                { 160,   162,   165,   167},   // 9
                                                { 163,   162,   165,   166},   // 9
                                                { 163,   162,   165,   167},   // 9
                                                { 164,   162,   165,   166},   // 9
                                                { 164,   162,   165,   167},   // 9
                                                { 160,   168,   170,   171},   // 9
                                                { 160,   168,   170,   172},   // 9
                                                { 169,   168,   170,   171},   // 9
                                                { 169,   168,   170,   172},   // 9
                                                { 168,   170,   172,   173},   // 9
                                                { 168,   170,   172,   174},   // 9
                                                { 168,   170,   172,   175},   // 9
                                                { 171,   170,   172,   173},   // 9
                                                { 171,   170,   172,   174},   // 9
                                                { 171,   170,   172,   175},   // 9
                                                { 170,   172,   175,   176},   // 9
                                                { 170,   172,   175,   177},   // 9
                                                { 173,   172,   175,   176},   // 9
                                                { 173,   172,   175,   177},   // 9
                                                { 174,   172,   175,   176},   // 9
                                                { 174,   172,   175,   177},   // 9
                                                { 172,   175,   177,   178},   // 9
                                                { 172,   175,   177,   179},   // 9
                                                { 176,   175,   177,   178},   // 9
                                                { 176,   175,   177,   179},   // 9
                                                { 175,   177,   179,   180},   // 9
                                                { 175,   177,   179,   181},   // 9
                                                { 175,   177,   179,   182},   // 9
                                                { 178,   177,   179,   180},   // 9
                                                { 178,   177,   179,   181},   // 9
                                                { 178,   177,   179,   182},   // 9
                                                { 177,   179,   182,   183},   // 9
                                                { 177,   179,   182,   184},   // 9
                                                { 180,   179,   182,   183},   // 9
                                                { 180,   179,   182,   184},   // 9
                                                { 181,   179,   182,   183},   // 9
                                                { 181,   179,   182,   184},   // 9
                                                { 179,   182,   184,   185},   // 9
                                                { 179,   182,   184,   188},   // 9
                                                { 183,   182,   184,   185},   // 9
                                                { 183,   182,   184,   188},   // 9
                                                { 182,   184,   185,   186},   // 9
                                                { 182,   184,   185,   187},   // 9
                                                { 182,   184,   185,   193},   // 9
                                                { 188,   184,   185,   186},   // 9
                                                { 188,   184,   185,   187},   // 9
                                                { 188,   184,   185,   193},   // 9
                                                { 182,   184,   188,   189},   // 9
                                                { 182,   184,   188,   190},   // 9
                                                { 182,   184,   188,   196},   // 9
                                                { 185,   184,   188,   189},   // 9
                                                { 185,   184,   188,   190},   // 9
                                                { 185,   184,   188,   196},   // 9
                                                { 184,   185,   193,   190},   // 9
                                                { 184,   185,   193,   194},   // 9
                                                { 184,   185,   193,   195},   // 9
                                                { 186,   185,   193,   190},   // 9
                                                { 186,   185,   193,   194},   // 9
                                                { 186,   185,   193,   195},   // 9
                                                { 187,   185,   193,   190},   // 9
                                                { 187,   185,   193,   194},   // 9
                                                { 187,   185,   193,   195},   // 9
                                                { 184,   188,   190,   191},   // 9
                                                { 184,   188,   190,   192},   // 9
                                                { 184,   188,   190,   193},   // 9
                                                { 189,   188,   190,   191},   // 9
                                                { 189,   188,   190,   192},   // 9
                                                { 189,   188,   190,   193},   // 9
                                                { 196,   188,   190,   191},   // 9
                                                { 196,   188,   190,   192},   // 9
                                                { 196,   188,   190,   193},   // 9
                                                { 184,   188,   196,   197},   // 9
                                                { 184,   188,   196,   198},   // 9
                                                { 189,   188,   196,   197},   // 9
                                                { 189,   188,   196,   198},   // 9
                                                { 190,   188,   196,   197},   // 9
                                                { 190,   188,   196,   198},   // 9
                                                { 188,   190,   193,   185},   // 9
                                                { 188,   190,   193,   194},   // 9
                                                { 188,   190,   193,   195},   // 9
                                                { 191,   190,   193,   185},   // 9
                                                { 191,   190,   193,   194},   // 9
                                                { 191,   190,   193,   195},   // 9
                                                { 192,   190,   193,   185},   // 9
                                                { 192,   190,   193,   194},   // 9
                                                { 192,   190,   193,   195},   // 9
                                                { 188,   196,   198,   199},   // 9
                                                { 188,   196,   198,   200},   // 9
                                                { 197,   196,   198,   199},   // 9
                                                { 197,   196,   198,   200},   // 9
                                                { 196,   198,   200,   201},   // 9
                                                { 196,   198,   200,   202},   // 9
                                                { 196,   198,   200,   207},   // 9
                                                { 199,   198,   200,   201},   // 9
                                                { 199,   198,   200,   202},   // 9
                                                { 199,   198,   200,   207},   // 9
                                                { 198,   200,   202,   203},   // 9
                                                { 198,   200,   202,   204},   // 9
                                                { 198,   200,   202,   205},   // 9
                                                { 201,   200,   202,   203},   // 9
                                                { 201,   200,   202,   204},   // 9
                                                { 201,   200,   202,   205},   // 9
                                                { 207,   200,   202,   203},   // 9
                                                { 207,   200,   202,   204},   // 9
                                                { 207,   200,   202,   205},   // 9
                                                { 198,   200,   207,   208},   // 9
                                                { 198,   200,   207,   209},   // 9
                                                { 201,   200,   207,   208},   // 9
                                                { 201,   200,   207,   209},   // 9
                                                { 202,   200,   207,   208},   // 9
                                                { 202,   200,   207,   209},   // 9
                                                { 200,   202,   205,   206},   // 9
                                                { 203,   202,   205,   206},   // 9
                                                { 204,   202,   205,   206},   // 9
                                                { 200,   207,   209,   210},   // 9
                                                { 200,   207,   209,   211},   // 9
                                                { 208,   207,   209,   210},   // 9
                                                { 208,   207,   209,   211},   // 9
                                                { 207,   209,   211,   212},   // 9
                                                { 207,   209,   211,   213},   // 9
                                                { 207,   209,   211,   218},   // 9
                                                { 210,   209,   211,   212},   // 9
                                                { 210,   209,   211,   213},   // 9
                                                { 210,   209,   211,   218},   // 9
                                                { 209,   211,   213,   214},   // 9
                                                { 209,   211,   213,   215},   // 9
                                                { 209,   211,   213,   216},   // 9
                                                { 212,   211,   213,   214},   // 9
                                                { 212,   211,   213,   215},   // 9
                                                { 212,   211,   213,   216},   // 9
                                                { 218,   211,   213,   214},   // 9
                                                { 218,   211,   213,   215},   // 9
                                                { 218,   211,   213,   216},   // 9
                                                { 209,   211,   218,   219},   // 9
                                                { 209,   211,   218,   220},   // 9
                                                { 212,   211,   218,   219},   // 9
                                                { 212,   211,   218,   220},   // 9
                                                { 213,   211,   218,   219},   // 9
                                                { 213,   211,   218,   220},   // 9
                                                { 211,   213,   216,   217},   // 9
                                                { 214,   213,   216,   217},   // 9
                                                { 215,   213,   216,   217},   // 9
                                                { 211,   218,   220,   221},   // 9
                                                { 211,   218,   220,   222},   // 9
                                                { 219,   218,   220,   221},   // 9
                                                { 219,   218,   220,   222},   // 9
                                                { 218,   220,   222,   223},   // 9
                                                { 218,   220,   222,   224},   // 9
                                                { 218,   220,   222,   225},   // 9
                                                { 221,   220,   222,   223},   // 9
                                                { 221,   220,   222,   224},   // 9
                                                { 221,   220,   222,   225},   // 9
                                                { 220,   222,   225,   226},   // 9
                                                { 220,   222,   225,   227},   // 9
                                                { 223,   222,   225,   226},   // 9
                                                { 223,   222,   225,   227},   // 9
                                                { 224,   222,   225,   226},   // 9
                                                { 224,   222,   225,   227},   // 9
                                                { 222,   225,   227,   228},   // 9
                                                { 222,   225,   227,   229},   // 9
                                                { 226,   225,   227,   228},   // 9
                                                { 226,   225,   227,   229},   // 9
                                                { 225,   227,   229,   230},   // 9
                                                { 225,   227,   229,   231},   // 9
                                                { 225,   227,   229,   249},   // 9
                                                { 228,   227,   229,   230},   // 9
                                                { 228,   227,   229,   231},   // 9
                                                { 228,   227,   229,   249},   // 9
                                                { 227,   229,   231,   232},   // 9
                                                { 227,   229,   231,   233},   // 9
                                                { 227,   229,   231,   234},   // 9
                                                { 230,   229,   231,   232},   // 9
                                                { 230,   229,   231,   233},   // 9
                                                { 230,   229,   231,   234},   // 9
                                                { 249,   229,   231,   232},   // 9
                                                { 249,   229,   231,   233},   // 9
                                                { 249,   229,   231,   234},   // 9
                                                { 227,   229,   249,   250},   // 9
                                                { 227,   229,   249,   251},   // 9
                                                { 230,   229,   249,   250},   // 9
                                                { 230,   229,   249,   251},   // 9
                                                { 231,   229,   249,   250},   // 9
                                                { 231,   229,   249,   251},   // 9
                                                { 229,   231,   234,   235},   // 9
                                                { 229,   231,   234,   236},   // 9
                                                { 229,   231,   234,   237},   // 9
                                                { 232,   231,   234,   235},   // 9
                                                { 232,   231,   234,   236},   // 9
                                                { 232,   231,   234,   237},   // 9
                                                { 233,   231,   234,   235},   // 9
                                                { 233,   231,   234,   236},   // 9
                                                { 233,   231,   234,   237},   // 9
                                                { 231,   234,   237,   238},   // 9
                                                { 231,   234,   237,   239},   // 9
                                                { 231,   234,   237,   240},   // 9
                                                { 235,   234,   237,   238},   // 9
                                                { 235,   234,   237,   239},   // 9
                                                { 235,   234,   237,   240},   // 9
                                                { 236,   234,   237,   238},   // 9
                                                { 236,   234,   237,   239},   // 9
                                                { 236,   234,   237,   240},   // 9
                                                { 234,   237,   240,   241},   // 9
                                                { 234,   237,   240,   242},   // 9
                                                { 238,   237,   240,   241},   // 9
                                                { 238,   237,   240,   242},   // 9
                                                { 239,   237,   240,   241},   // 9
                                                { 239,   237,   240,   242},   // 9
                                                { 237,   240,   242,   243},   // 9
                                                { 237,   240,   242,   246},   // 9
                                                { 241,   240,   242,   243},   // 9
                                                { 241,   240,   242,   246},   // 9
                                                { 240,   242,   243,   244},   // 9
                                                { 240,   242,   243,   245},   // 9
                                                { 246,   242,   243,   244},   // 9
                                                { 246,   242,   243,   245},   // 9
                                                { 240,   242,   246,   247},   // 9
                                                { 240,   242,   246,   248},   // 9
                                                { 243,   242,   246,   247},   // 9
                                                { 243,   242,   246,   248},   // 9
                                                { 229,   249,   251,   252},   // 9
                                                { 229,   249,   251,   255},   // 9
                                                { 250,   249,   251,   252},   // 9
                                                { 250,   249,   251,   255},   // 9
                                                { 249,   251,   252,   253},   // 9
                                                { 249,   251,   252,   254},   // 9
                                                { 249,   251,   252,   260},   // 9
                                                { 255,   251,   252,   253},   // 9
                                                { 255,   251,   252,   254},   // 9
                                                { 255,   251,   252,   260},   // 9
                                                { 249,   251,   255,   256},   // 9
                                                { 249,   251,   255,   257},   // 9
                                                { 249,   251,   255,   263},   // 9
                                                { 252,   251,   255,   256},   // 9
                                                { 252,   251,   255,   257},   // 9
                                                { 252,   251,   255,   263},   // 9
                                                { 251,   252,   260,   257},   // 9
                                                { 251,   252,   260,   261},   // 9
                                                { 251,   252,   260,   262},   // 9
                                                { 253,   252,   260,   257},   // 9
                                                { 253,   252,   260,   261},   // 9
                                                { 253,   252,   260,   262},   // 9
                                                { 254,   252,   260,   257},   // 9
                                                { 254,   252,   260,   261},   // 9
                                                { 254,   252,   260,   262},   // 9
                                                { 251,   255,   257,   258},   // 9
                                                { 251,   255,   257,   259},   // 9
                                                { 251,   255,   257,   260},   // 9
                                                { 256,   255,   257,   258},   // 9
                                                { 256,   255,   257,   259},   // 9
                                                { 256,   255,   257,   260},   // 9
                                                { 263,   255,   257,   258},   // 9
                                                { 263,   255,   257,   259},   // 9
                                                { 263,   255,   257,   260},   // 9
                                                { 251,   255,   263,   264},   // 9
                                                { 251,   255,   263,   265},   // 9
                                                { 256,   255,   263,   264},   // 9
                                                { 256,   255,   263,   265},   // 9
                                                { 257,   255,   263,   264},   // 9
                                                { 257,   255,   263,   265},   // 9
                                                { 255,   257,   260,   252},   // 9
                                                { 255,   257,   260,   261},   // 9
                                                { 255,   257,   260,   262},   // 9
                                                { 258,   257,   260,   252},   // 9
                                                { 258,   257,   260,   261},   // 9
                                                { 258,   257,   260,   262},   // 9
                                                { 259,   257,   260,   252},   // 9
                                                { 259,   257,   260,   261},   // 9
                                                { 259,   257,   260,   262},   // 9
                                                { 255,   263,   265,   266},   // 9
                                                { 255,   263,   265,   269},   // 9
                                                { 264,   263,   265,   266},   // 9
                                                { 264,   263,   265,   269},   // 9
                                                { 263,   265,   266,   267},   // 9
                                                { 263,   265,   266,   268},   // 9
                                                { 263,   265,   266,   274},   // 9
                                                { 269,   265,   266,   267},   // 9
                                                { 269,   265,   266,   268},   // 9
                                                { 269,   265,   266,   274},   // 9
                                                { 263,   265,   269,   270},   // 9
                                                { 263,   265,   269,   271},   // 9
                                                { 263,   265,   269,   277},   // 9
                                                { 266,   265,   269,   270},   // 9
                                                { 266,   265,   269,   271},   // 9
                                                { 266,   265,   269,   277},   // 9
                                                { 265,   266,   274,   271},   // 9
                                                { 265,   266,   274,   275},   // 9
                                                { 265,   266,   274,   276},   // 9
                                                { 267,   266,   274,   271},   // 9
                                                { 267,   266,   274,   275},   // 9
                                                { 267,   266,   274,   276},   // 9
                                                { 268,   266,   274,   271},   // 9
                                                { 268,   266,   274,   275},   // 9
                                                { 268,   266,   274,   276},   // 9
                                                { 265,   269,   271,   272},   // 9
                                                { 265,   269,   271,   273},   // 9
                                                { 265,   269,   271,   274},   // 9
                                                { 270,   269,   271,   272},   // 9
                                                { 270,   269,   271,   273},   // 9
                                                { 270,   269,   271,   274},   // 9
                                                { 277,   269,   271,   272},   // 9
                                                { 277,   269,   271,   273},   // 9
                                                { 277,   269,   271,   274},   // 9
                                                { 265,   269,   277,   278},   // 9
                                                { 265,   269,   277,   279},   // 9
                                                { 270,   269,   277,   278},   // 9
                                                { 270,   269,   277,   279},   // 9
                                                { 271,   269,   277,   278},   // 9
                                                { 271,   269,   277,   279},   // 9
                                                { 269,   271,   274,   266},   // 9
                                                { 269,   271,   274,   275},   // 9
                                                { 269,   271,   274,   276},   // 9
                                                { 272,   271,   274,   266},   // 9
                                                { 272,   271,   274,   275},   // 9
                                                { 272,   271,   274,   276},   // 9
                                                { 273,   271,   274,   266},   // 9
                                                { 273,   271,   274,   275},   // 9
                                                { 273,   271,   274,   276},   // 9
                                                { 269,   277,   279,   280},   // 9
                                                { 269,   277,   279,   283},   // 9
                                                { 278,   277,   279,   280},   // 9
                                                { 278,   277,   279,   283},   // 9
                                                { 277,   279,   280,   281},   // 9
                                                { 277,   279,   280,   282},   // 9
                                                { 277,   279,   280,   288},   // 9
                                                { 283,   279,   280,   281},   // 9
                                                { 283,   279,   280,   282},   // 9
                                                { 283,   279,   280,   288},   // 9
                                                { 277,   279,   283,   284},   // 9
                                                { 277,   279,   283,   285},   // 9
                                                { 277,   279,   283,   291},   // 9
                                                { 280,   279,   283,   284},   // 9
                                                { 280,   279,   283,   285},   // 9
                                                { 280,   279,   283,   291},   // 9
                                                { 279,   280,   288,   285},   // 9
                                                { 279,   280,   288,   289},   // 9
                                                { 279,   280,   288,   290},   // 9
                                                { 281,   280,   288,   285},   // 9
                                                { 281,   280,   288,   289},   // 9
                                                { 281,   280,   288,   290},   // 9
                                                { 282,   280,   288,   285},   // 9
                                                { 282,   280,   288,   289},   // 9
                                                { 282,   280,   288,   290},   // 9
                                                { 279,   283,   285,   286},   // 9
                                                { 279,   283,   285,   287},   // 9
                                                { 279,   283,   285,   288},   // 9
                                                { 284,   283,   285,   286},   // 9
                                                { 284,   283,   285,   287},   // 9
                                                { 284,   283,   285,   288},   // 9
                                                { 291,   283,   285,   286},   // 9
                                                { 291,   283,   285,   287},   // 9
                                                { 291,   283,   285,   288},   // 9
                                                { 279,   283,   291,   292},   // 9
                                                { 279,   283,   291,   293},   // 9
                                                { 284,   283,   291,   292},   // 9
                                                { 284,   283,   291,   293},   // 9
                                                { 285,   283,   291,   292},   // 9
                                                { 285,   283,   291,   293},   // 9
                                                { 283,   285,   288,   280},   // 9
                                                { 283,   285,   288,   289},   // 9
                                                { 283,   285,   288,   290},   // 9
                                                { 286,   285,   288,   280},   // 9
                                                { 286,   285,   288,   289},   // 9
                                                { 286,   285,   288,   290},   // 9
                                                { 287,   285,   288,   280},   // 9
                                                { 287,   285,   288,   289},   // 9
                                                { 287,   285,   288,   290},   // 9
                                                { 283,   291,   293,   294},   // 9
                                                { 283,   291,   293,   295},   // 9
                                                { 292,   291,   293,   294},   // 9
                                                { 292,   291,   293,   295},   // 9
                                                { 291,   293,   295,   296},   // 9
                                                { 291,   293,   295,   297},   // 9
                                                { 291,   293,   295,   302},   // 9
                                                { 294,   293,   295,   296},   // 9
                                                { 294,   293,   295,   297},   // 9
                                                { 294,   293,   295,   302},   // 9
                                                { 293,   295,   297,   298},   // 9
                                                { 293,   295,   297,   299},   // 9
                                                { 293,   295,   297,   300},   // 9
                                                { 296,   295,   297,   298},   // 9
                                                { 296,   295,   297,   299},   // 9
                                                { 296,   295,   297,   300},   // 9
                                                { 302,   295,   297,   298},   // 9
                                                { 302,   295,   297,   299},   // 9
                                                { 302,   295,   297,   300},   // 9
                                                { 293,   295,   302,   303},   // 9
                                                { 293,   295,   302,   304},   // 9
                                                { 296,   295,   302,   303},   // 9
                                                { 296,   295,   302,   304},   // 9
                                                { 297,   295,   302,   303},   // 9
                                                { 297,   295,   302,   304},   // 9
                                                { 295,   297,   300,   301},   // 9
                                                { 298,   297,   300,   301},   // 9
                                                { 299,   297,   300,   301}};  // 9

     const unsigned int dihedrals_2[49][4] =  {{ 10,     7,    12,    11},     // 2
                                               { 10,    12,     7,    11},     // 2
                                               { 12,    10,    14,    13},     // 2
                                               { 12,    10,    13,    14},     // 2
                                               { 15,     5,    17,    16},     // 2
                                               { 17,    15,    19,    18},     // 2
                                               { 34,    19,    36,    35},     // 2
                                               { 36,    34,    38,    37},     // 2
                                               { 55,    38,    57,    56},     // 2
                                               { 57,    55,    59,    58},     // 2
                                               { 74,    59,    76,    75},     // 2
                                               { 76,    74,    78,    77},     // 2
                                               { 86,    83,    88,    87},     // 2
                                               { 86,    88,    83,    87},     // 2
                                               { 88,    86,    90,    89},     // 2
                                               { 88,    86,    89,    90},     // 2
                                               { 91,    78,    93,    92},     // 2
                                               { 93,    91,    95,    94},     // 2
                                               {115,    95,   117,   116},     // 2
                                               {117,   115,   119,   118},     // 2
                                               {134,   119,   136,   135},     // 2
                                               {136,   134,   138,   137},     // 2
                                               {156,   138,   158,   157},     // 2
                                               {158,   156,   160,   159},     // 2
                                               {165,   162,   167,   166},     // 2
                                               {168,   160,   170,   169},     // 2
                                               {170,   168,   172,   171},     // 2
                                               {175,   172,   177,   176},     // 2
                                               {177,   175,   179,   178},     // 2
                                               {182,   179,   184,   183},     // 2
                                               {184,   182,   188,   185},     // 2
                                               {196,   188,   198,   197},     // 2
                                               {198,   196,   200,   199},     // 2
                                               {207,   200,   209,   208},     // 2
                                               {209,   207,   211,   210},     // 2
                                               {218,   211,   220,   219},     // 2
                                               {220,   218,   222,   221},     // 2
                                               {225,   222,   227,   226},     // 2
                                               {227,   225,   229,   228},     // 2
                                               {240,   246,   243,   242},     // 2
                                               {249,   229,   251,   250},     // 2
                                               {251,   249,   255,   252},     // 2
                                               {263,   255,   265,   264},     // 2
                                               {265,   263,   269,   266},     // 2
                                               {277,   269,   279,   278},     // 2
                                               {279,   277,   283,   280},     // 2
                                               {291,   283,   293,   292},     // 2
                                               {293,   291,   295,   294},     // 2
                                               {302,   295,   304,   303}};    // 2
//! Torsion energy term
class TermGromacsTorsion: public EnergyTermCommon<TermGromacsTorsion, ChainFB> {

private:

     //! For convenience, define local EnergyTermCommon
     typedef phaistos::EnergyTermCommon<TermGromacsTorsion, ChainFB> EnergyTermCommon;

     //! Number of interactions calculated
     int counter;

public:

     //! Use same settings as base class
     typedef EnergyTerm<ChainFB>::SettingsClassicEnergy Settings;

     //! Constructor.
     //! \param chain Molecule chain
     //! \param settings Local Settings object
     //! \param random_number_engine Object from which random number generators can be created.
     TermGromacsTorsion(ChainFB *chain,
                        const Settings &settings=Settings(),
                        RandomNumberEngine *random_number_engine = &random_global)
          : EnergyTermCommon(chain, "gromacs-torsion", settings, random_number_engine) {

     }

     //! Copy constructor.
     //! \param other Source object from which copy is made
     //! \param random_number_engine Object from which random number generators can be created.
     //! \param thread_index Index indicating in which thread|rank the copy exists
     //! \param chain Molecule chain
     TermGromacsTorsion(const TermGromacsTorsion &other,
                        RandomNumberEngine *random_number_engine,
                        int thread_index, ChainFB *chain)
          : EnergyTermCommon(other, random_number_engine, thread_index, chain),
            counter(other.counter) {

     }

     //! Evaluate chain energy
     //! \param move_info object containing information about last move
     //! \return torsional potential energy of the chain in the object
     double evaluate(MoveInfo *move_info=NULL) {


          std::vector<Vector_3D> coordinates;

          unsigned int i = 0;
          for (AtomIterator<ChainFB, definitions::ALL> atom(*chain); !atom.end(); ++atom) {

              i++;
              coordinates.push_back(atom->position);
              std::cout << i << atom->position << std::endl;

          }

          for (unsigned int i = 0; i < 843; i++){

              std::cout << i << "  " <<
                        dihedrals_9[i][0]  << "  " <<
                        dihedrals_9[i][1]  << "  " <<
                        dihedrals_9[i][2]  << "  " <<
                        dihedrals_9[i][3]  << "  " << std::endl;
//                     calc_dihedral(coordinates[dihedrals_9[i][0] - 1],
//                                   coordinates[dihedrals_9[i][1] - 1],
//                                   coordinates[dihedrals_9[i][2] - 1],
//                                   coordinates[dihedrals_9[i][3] - 1])
//                   << std::endl;
//                std::cout << coordinates[dihedrals_9[i][0] - 1] << std::endl;
//                std::cout << coordinates[dihedrals_9[i][1] - 1] << std::endl;
//                std::cout << coordinates[dihedrals_9[i][2] - 1] << std::endl;
//                std::cout << coordinates[dihedrals_9[i][3] - 1] << std::endl;
// 


          }




          return 0;

     }





//     //! Evaluate torsion energy for a bond (atom2-atom3)
//     //! \param atom2 First atom defining the bond
//     //! \param atom3 Second atom defining the bond
//     //! \return Torsional energy of that bond
//     inline double calc_torsion_energy(Atom *atom2, Atom *atom3) {
//          double angle,energy = 0.0;
//          CovalentBondIterator<ChainFB> it1(atom2, CovalentBondIterator<ChainFB>::DEPTH_1_ONLY);
//          for (; !it1.end(); ++it1) {
//               Atom *atom1 = &*it1;
//               if (atom1 == atom3)
//                    continue;
//               CovalentBondIterator<ChainFB> it4(atom3, CovalentBondIterator<ChainFB>::DEPTH_1_ONLY);
//               for (; !it4.end(); ++it4) {
//                    Atom *atom4 = &*it4;
//                    if (atom4 == atom2)
//                         continue;
//                    double param = 1.0;
//                    angle = calc_dihedral(atom1->position,atom2->position,
//                                          atom3->position,atom4->position);
//                    energy += calc_spring_energy(angle,param);
//               }
//          }
//          return energy;
//     }
//
//     //! Evaluate a single torsional term
//     //! \param angle Dihedral angle
//     //! \param param Parameter container
//     inline double calc_spring_energy(double angle, double param) {
//          double energy=0.0;
//          counter++;
//          //cos is symmetric around angle so we need not flip sign when param is mirrored
//          energy += param*( 1 + cos(param*angle - param) );
//
//          return energy;
//     }
//
//     //! Evaluate chain energy
//     //! \param move_info object containing information about last move
//     //! \return torsional potential energy of the chain in the object
//     double evaluate(MoveInfo *move_info=NULL) {
//
//          double energy_sum=0.0;
//          counter=0;
//
//          // all torsions
//          int size = (this->chain)->size();
//          for (int r=0; r<size; r++) {
//               Residue *res = &(*(this->chain))[r];
//               int res_size = res->size();
//               for (int a=0; a<res_size; a++) {
//                    Atom *atom2 = res->atoms[a];
//                    CovalentBondIterator<ChainFB> it(atom2, CovalentBondIterator<ChainFB>::DEPTH_1_ONLY);
//                    for (; !it.end(); ++it) {
//                         Atom *atom3 = &*it;
//                         if(atom2->index < atom3->index)
//                              energy_sum += calc_torsion_energy(atom2,atom3);
//                    }
//               }
//          }
//
//          /* // phaistos degrees of freedom only */
//          /* DofIterator::angle_selection_enum dofs = DofIterator::DIHEDRAL_DOFS + */
//          /*      DofIterator::CHI_ANGLES + DofIterator::N_DIHEDRAL; */
//          /* DofIterator dofIt((*chain)(0,N),DofIterator::DIHEDRAL,dofs); */
//          /* DofIterator end = chain->dofIteratorEnd(); */
//          /* for (; dofIt!=end; ++dofIt) { */
//          /*      Atom *atom3 = dofIt.getAtom(); */
//          /*      Atom *atom1init,*atom2,*atom4init; */
//          /*      atom3->get_dihedral_atoms(&atom1init,&atom2,&atom3,&atom4init); */
//          /*      energy_sum += calc_torsion_energy(atom2,atom3); */
//          /* } */
//
//          //energy_sum *= parameters.torsion_unit;
//
//          /* std::cout<<"Torsional Angle "<<energy_sum<<" kcal/mol "<<counter<<" interactions\n"; */
//
//          return energy_sum;
//     }
};

}

#endif
